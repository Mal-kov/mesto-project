(()=>{"use strict";var e={937:(e,t,o)=>{e.exports=o.p+"bbe2a6eafac19c3d031c.svg"}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var c=t[n]={exports:{}};return e[n](c,c.exports,o),c.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.p="";var n={};(()=>{o.d(n,{ZU:()=>J,zS:()=>A,AV:()=>U,wL:()=>F,vi:()=>x,CV:()=>w,cp:()=>O,QN:()=>E});var e=function(e){O.setAttribute("disabled",!0),O.classList.add(e),F.setAttribute("disabled",!0),F.classList.add(e)},t=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",c)},r=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",c)},c=function(e){if(e.keyCode==J){var t=document.querySelector(".popup_opened");r(t)}},l={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort7",headers:{authorization:"f413e3da-678f-4c47-9635-459b1d831638","Content-Type":"application/json"}},a=function(e){return e.ok?e.json():Promise.reject("Ошибка - ".concat(e.status))},u=function(){return fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then(a)},i=function(){return fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then(a)},s=document.querySelector(".elements__list"),p=document.querySelector("#popup-place-name"),d=document.querySelector("#popup-place-link"),f=function(e){var t=_(e);s.prepend(t)},_=function(e){console.log(e);var o=document.querySelector("#place-template").content.querySelector(".elements__item").cloneNode(!0);e.owner._id===E?m(e,o):o.querySelector(".elements__btn-trash").remove(),o.querySelector(".elements__title").textContent=e.name,o.querySelector(".elements__like-count").textContent=e.likes.length;var n=o.querySelector(".elements__img");return n.setAttribute("src",e.link),n.setAttribute("alt",e.name),o.querySelector(".elements__img").addEventListener("click",(function(e){!function(e,o){t(x),A.setAttribute("src",o),A.setAttribute("alt",e),U.textContent=e}(e.target.alt,e.target.currentSrc)})),v(e,o),o},m=function(e,t){t.setAttribute("data-id",e._id),t.querySelector(".elements__btn-trash").addEventListener("click",(function(){var o;console.log("есть клик на кнопке подтверждения удаления карты"),(o=e._id,fetch("".concat(l.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:l.headers}).then(a)).then((function(){t.remove(),console.log("Карточка успешно удалена"),console.log(e._id)})).catch((function(e){console.log("Ошибка удаления карты"),console.log(e)}))}))},v=function(e,t){var o=0;t.querySelector(".elements__btn-heart").addEventListener("click",(function(n){var r;++o%2?(console.log("Поставил лайк"),(r=e._id,fetch("".concat(l.baseUrl,"/cards/likes/").concat(r),{method:"PUT",headers:l.headers}).then(a)).then((function(e){n.target.classList.toggle("elements__btn-heart_active"),t.querySelector(".elements__like-count").textContent=e.likes.length})).catch((function(e){console.log("Ошибка постановки лайка",e)}))):(console.log("Снял лайк"),function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:l.headers}).then(a)}(e._id).then((function(e){n.target.classList.toggle("elements__btn-heart_active"),t.querySelector(".elements__like-count").textContent=e.likes.length})).catch((function(e){console.log("Ошибка удаления лайка",e)})))}))},y=o(937);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}var g=document.querySelector(".header__logo"),b=document.querySelector(".profile__image"),S=document.querySelector(".profile__name"),q=document.querySelector(".profile__skills"),E="",L=document.querySelector(".profile__btn-edit"),C=document.querySelector(".profile__btn-add"),k=document.querySelector(".profile__image-edit"),x=document.querySelector(".popup_type_image"),A=x.querySelector(".popup__image-big"),U=x.querySelector(".popup__image-title"),T=document.querySelector(".popup_type_profile"),w=document.querySelector(".popup_type_place"),O=w.querySelector(".popup__btn-save"),j=w.querySelector(".popup__form_type_place"),P=T.querySelector(".popup__form_type_profile"),B=P.querySelector("#popup-profile-name"),D=P.querySelector("#popup-profile-skills"),I=document.querySelector(".popup_type_avatar"),N=I.querySelector("#popup-avatar-link"),F=I.querySelector(".popup__btn-save"),J="27",M=document.querySelector(".profile__name"),z=document.querySelector(".profile__skills");k.addEventListener("click",(function(){e("popup__btn-save_inactive"),t(I)})),L.addEventListener("click",(function(){t(T),H()})),C.addEventListener("click",(function(){e("popup__btn-save_inactive"),t(w)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup_opened")&&(console.log("Есть клик оверлея"),r(e)),t.target.classList.contains("popup__btn-close")&&(r(e),console.log("Есть клик на кнопке закрытия окна"))}))})),g.src=y,I.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=N.value,fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})}).then(a)).then((function(e){console.log(e),b.src=e.avatar,N.value="",r(I)})).catch((function(e){console.log("Ошибка изменения аватара"),console.log(e)})).finally((function(){}))})),P.addEventListener("submit",(function(e){e.preventDefault();var t=B.value,o=D.value;(function(e,t){return fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(a)})(t,o).then((function(e){M.textContent=t,z.textContent=o,console.log("Загрузка Имя: ".concat(t," Профиль ").concat(o," ")),console.log("Загрузка изменений имени - выполнена"),console.log(e),r(T)})).catch((function(e){console.log("Ошибка загрузки изменений "),console.log(e)})).finally((function(){}))})),j.addEventListener("submit",(function(e){var t,o;e.preventDefault(),(t=p.value,o=d.value,fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:t,link:o})}).then(a)).then((function(e){console.log("Новая карточка создана"),console.log(e),f(e),r(w),p.value="",d.value=""})).catch((function(e){console.log("Ошибка создания новой карточки"),console.log(e)}))}));var H=function(){i().then((function(e){e.reverse().forEach((function(e){f(e)}))})).catch((function(e){console.log("Ошибка при отрисовке карт",e)})).finally((function(){}))};!function(t){var o=document.querySelectorAll(t.formSelector),n=Array.from(o);e(t.inactiveButtonClass);var r=function(e){e.preventDefault()};n.forEach((function(e){e.addEventListener("submit",r),function(e,t){var o=e.querySelectorAll(t.inputSelector),n=Array.from(o),r=e.querySelector(t.submitButtonSelector);n.forEach((function(e){e.addEventListener("input",(function(){!function(e,t){e.validity.valid?function(e,t){var o=e.closest(t.popupFormSection).querySelector(t.popupInputTextError);o.textContent="",o.classList.remove(t.inputErrorClass),e.classList.remove(t.errorClass)}(e,t):function(e,t,o){var n=e.closest(o.popupFormSection).querySelector(o.popupInputTextError);n.textContent=t,n.classList.add(o.inputErrorClass),e.classList.add(o.errorClass)}(e,e.validationMessage,t)}(e,t),function(e,t,o){var n=e.some((function(e){return!e.validity.valid})),r=e.some((function(e){return e.validity.valueMissing}));console.log(r),n?(t.classList.add(o.inactiveButtonClass),t.setAttribute("disabled",!0)):(t.classList.remove(o.inactiveButtonClass),t.removeAttribute("disabled"))}(n,r,t)}))}))}(e,t)}))}({formSelector:".popup__form",inputSelector:".popup__input-text",submitButtonSelector:".popup__btn-save",popupFormSection:".popup__form-section",popupInputTextError:".popup__input-text-error",inactiveButtonClass:"popup__btn-save_inactive",inputErrorClass:"popup__input-text-error_active",errorClass:"popup__input-text_err"}),Promise.all([u(),i()]).then((function(e){var t,o,n=(o=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,r,c=[],l=!0,a=!1;try{for(o=o.call(e);!(l=(n=o.next()).done)&&(c.push(n.value),!t||c.length!==t);l=!0);}catch(e){a=!0,r=e}finally{try{l||null==o.return||o.return()}finally{if(a)throw r}}return c}}(t,o)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?h(e,t):void 0}}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=(n[0],n[1]);u().then((function(e){b.src=e.avatar,S.textContent=e.name,q.textContent=e.about,E=e._id,B.value=e.name,D.value=e.about,console.log("Загрузка информации о пользователе - выполнена"),console.log(e)})).catch((function(e){console.log("Ошибка загрузки информации о пользователе"),console.log(e)})).finally((function(){})),H(r)})).catch((function(e){console.log("Ошибка при отработке общего промиса данные + карты",e)}))})()})();