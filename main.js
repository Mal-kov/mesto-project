(()=>{"use strict";var e={937:(e,t,o)=>{e.exports=o.p+"bbe2a6eafac19c3d031c.svg"}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var c=t[n]={exports:{}};return e[n](c,c.exports,o),c.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.p="";var n={};(()=>{o.d(n,{ZU:()=>M,zS:()=>U,AV:()=>T,wL:()=>J,vi:()=>A,CV:()=>O,cp:()=>j,QN:()=>L});var e=function(e){j.setAttribute("disabled",!0),j.classList.add(e),J.setAttribute("disabled",!0),J.classList.add(e)},t=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",c)},r=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",c)},c=function(e){if(e.keyCode==M){var t=document.querySelector(".popup_opened");r(t)}},l={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort7",headers:{authorization:"f413e3da-678f-4c47-9635-459b1d831638","Content-Type":"application/json"}},a=function(e){return e.ok?e.json():Promise.reject("Ошибка - ".concat(e.status))},u=function(){return fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then(a)},i=function(){return fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then(a)},s=document.querySelector(".elements__list"),p=document.querySelector("#popup-place-name"),d=document.querySelector("#popup-place-link"),f=document.querySelector(".popup_delete-card"),_=f.querySelector(".popup__btn-save"),m=function(e){var t=v(e);s.prepend(t)},v=function(e){console.log(e);var o=0,n=document.querySelector("#place-template").content.querySelector(".elements__item").cloneNode(!0);e.owner._id===L?n.querySelector(".elements__btn-trash").addEventListener("click",(function(o){t(f),_.addEventListener("click",(function(t){y(e,n),console.log(t)}))})):n.querySelector(".elements__btn-trash").remove(),n.querySelector(".elements__title").textContent=e.name,n.querySelector(".elements__like-count").textContent=e.likes.length;var r=n.querySelector(".elements__img");return r.setAttribute("src",e.link),r.setAttribute("alt",e.name),n.querySelector(".elements__img").addEventListener("click",(function(e){!function(e,o){t(A),U.setAttribute("src",o),U.setAttribute("alt",e),T.textContent=e}(e.target.alt,e.target.currentSrc)})),n.querySelector(".elements__btn-heart").addEventListener("click",(function(t){var r;++o%2?(console.log("Поставил лайк"),(r=e._id,fetch("".concat(l.baseUrl,"/cards/likes/").concat(r),{method:"PUT",headers:l.headers}).then(a)).then((function(e){t.target.classList.toggle("elements__btn-heart_active"),n.querySelector(".elements__like-count").textContent=e.likes.length}))):(console.log("Снял лайк"),function(e){return fetch("".concat(l.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:l.headers}).then(a)}(e._id).then((function(e){t.target.classList.toggle("elements__btn-heart_active"),n.querySelector(".elements__like-count").textContent=e.likes.length})))})),n},y=function(e,t){var o;console.log(e._id),console.log("есть клик на кнопке подтверждения удаления карты"),(o=e._id,fetch("".concat(l.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:l.headers}).then(a)).then((function(){t.remove(),console.log("Карточка успешно удалена"),r(f),console.log(e._id)})).catch((function(e){console.log("Ошибка удаления карты"),console.log(e)})).finally((function(){}))},h=o(937);function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}var S=document.querySelector(".header__logo"),b=document.querySelector(".profile__image"),q=document.querySelector(".profile__name"),E=document.querySelector(".profile__skills"),L="",k=document.querySelector(".profile__btn-edit"),C=document.querySelector(".profile__btn-add"),x=document.querySelector(".profile__image-edit"),A=document.querySelector(".popup_type_image"),U=A.querySelector(".popup__image-big"),T=A.querySelector(".popup__image-title"),w=document.querySelector(".popup_type_profile"),O=document.querySelector(".popup_type_place"),j=O.querySelector(".popup__btn-save"),P=O.querySelector(".popup__form_type_place"),B=w.querySelector(".popup__form_type_profile"),D=B.querySelector("#popup-profile-name"),I=B.querySelector("#popup-profile-skills"),N=document.querySelector(".popup_type_avatar"),F=N.querySelector("#popup-avatar-link"),J=N.querySelector(".popup__btn-save"),M="27",z=document.querySelector(".profile__name"),H=document.querySelector(".profile__skills");x.addEventListener("click",(function(){e("popup__btn-save_inactive"),t(N)})),k.addEventListener("click",(function(){t(w),V()})),C.addEventListener("click",(function(){e("popup__btn-save_inactive"),t(O)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup_opened")&&(console.log("Есть клик оверлея"),r(e)),t.target.classList.contains("popup__btn-close")&&(r(e),console.log("Есть клик на кнопке закрытия окна"))}))})),S.src=h,N.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=F.value,fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:t})}).then(a)).then((function(e){console.log(e),b.src=e.avatar,F.value="",r(N)})).catch((function(e){console.log("Ошибка изменения аватара"),console.log(e)})).finally((function(){}))})),B.addEventListener("submit",(function(e){e.preventDefault();var t=D.value,o=I.value;(function(e,t){return fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(a)})(t,o).then((function(e){z.textContent=t,H.textContent=o,console.log("Загрузка Имя: ".concat(t," Профиль ").concat(o," ")),console.log("Загрузка изменений имени - выполнена"),console.log(e),r(w)})).catch((function(e){console.log("Ошибка загрузки изменений "),console.log(e)})).finally((function(){}))})),P.addEventListener("submit",(function(e){var t,o;e.preventDefault(),(t=p.value,o=d.value,fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:t,link:o})}).then(a)).then((function(e){console.log("Новая карточка создана"),console.log(e),m(e),r(O),p.value="",d.value=""})).catch((function(e){console.log("Ошибка создания новой карточки"),console.log(e)})).finally((function(){}))}));var V=function(){i().then((function(e){e.forEach((function(e){m(e)}))})).catch((function(e){console.log("Ошибка при отрисовке карт",e)})).finally((function(){}))};!function(t){var o=document.querySelectorAll(t.formSelector),n=Array.from(o);e(t.inactiveButtonClass);var r=function(e){e.preventDefault()};n.forEach((function(e){e.addEventListener("submit",r),function(e,t){var o=e.querySelectorAll(t.inputSelector),n=Array.from(o),r=e.querySelector(t.submitButtonSelector);n.forEach((function(e){e.addEventListener("input",(function(){!function(e,t){e.validity.valid?function(e,t){var o=e.closest(t.popupFormSection).querySelector(t.popupInputTextError);o.textContent="",o.classList.remove(t.inputErrorClass),e.classList.remove(t.errorClass)}(e,t):function(e,t,o){var n=e.closest(o.popupFormSection).querySelector(o.popupInputTextError);n.textContent=t,n.classList.add(o.inputErrorClass),e.classList.add(o.errorClass)}(e,e.validationMessage,t)}(e,t),function(e,t,o){var n=e.some((function(e){return!e.validity.valid})),r=e.some((function(e){return e.validity.valueMissing}));console.log(r),n?(t.classList.add(o.inactiveButtonClass),t.setAttribute("disabled",!0)):(t.classList.remove(o.inactiveButtonClass),t.removeAttribute("disabled"))}(n,r,t)}))}))}(e,t)}))}({formSelector:".popup__form",inputSelector:".popup__input-text",submitButtonSelector:".popup__btn-save",popupFormSection:".popup__form-section",popupInputTextError:".popup__input-text-error",inactiveButtonClass:"popup__btn-save_inactive",inputErrorClass:"popup__input-text-error_active",errorClass:"popup__input-text_err"}),Promise.all([u(),i()]).then((function(e){var t,o,n=(o=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,r,c=[],l=!0,a=!1;try{for(o=o.call(e);!(l=(n=o.next()).done)&&(c.push(n.value),!t||c.length!==t);l=!0);}catch(e){a=!0,r=e}finally{try{l||null==o.return||o.return()}finally{if(a)throw r}}return c}}(t,o)||function(e,t){if(e){if("string"==typeof e)return g(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?g(e,t):void 0}}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=(n[0],n[1]);u().then((function(e){b.src=e.avatar,q.textContent=e.name,E.textContent=e.about,L=e._id,D.value=e.name,I.value=e.about,console.log("Загрузка информации о пользователе - выполнена"),console.log(e)})).catch((function(e){console.log("Ошибка загрузки информации о пользователе"),console.log(e)})).finally((function(){})),V(r)})).catch((function(e){console.log("Ошибка при отработке общего промиса данные + карты",e)}))})()})();